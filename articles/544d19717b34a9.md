---
title: "AWS ChatbotãŒCDKçµŒç”±ã§SNS Topicã®Subscriptionã«å¤±æ•—ã™ã‚‹ â†’ dependencyã‚’æ˜ç¤ºã—ã¾ã—ã‚‡ã†ã€‚"
emoji: "ğŸ”–"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["aws", "chatbot", "cdk"]
published: true
---

# TL;DR

CDKã§SlackChannelConfigurationã‚’Updateã™ã‚‹éš›ã€SNS TopicãŒChatbotå´ã«ã¯ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ãŒSubscriptionãŒå¤±æ•—ã™ã‚‹ã“ã¨ãŒã‚ã‚‹ã€‚
â†’ `SlackChannelConfiguration` ã«å¯¾ã—ã¦ SNS Topic ã‚’ `addDependency` ã—ã¾ã—ã‚‡ã†

![](https://storage.googleapis.com/zenn-user-upload/mhbsn0bn7ns7y3csnwtu00f88mr2)

## çµŒç·¯

AWS Chatbotã«å¯¾ã—ã¦CDKã§Subscriptionã‚’è¨­å®šã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€SNS Topicå´ã®Subscriptionãƒªã‚½ãƒ¼ã‚¹ã§ã¯è¨­å®šã§ããªã„ã€‚
ä»£ã‚ã‚Šã«ã€`SlackChannelConfiguration` ã‚¯ãƒ©ã‚¹ã® `notificationTopics` ã§è¨­å®šã™ã‚‹ã“ã¨ã«ãªã‚‹ã€‚

ã—ã‹ã—ã€`notificationTopics`ã¯CloudFormationã«ãƒªã‚½ãƒ¼ã‚¹ã®ä¾å­˜é–¢ä¿‚ã‚’ä¼ãˆãªã„ã‚‰ã—ã„ã€‚
ã—ãŸãŒã£ã¦ã€addDependencyã§æ˜ç¤ºçš„ã«ä¾å­˜é–¢ä¿‚ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã«ãªã‚‹ã€‚

## ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰

```ts
export type ChatbotStackProps = {
  topics: Topic[];
} & cdk.StackProps;

export class ChatbotStack extends cdk.Stack {
  constructor(scope: cdk.Construct, id: string, props: ChatbotStackProps) {
    super(scope, id, props);

    const role = chatbotRole(this, "chatbotRole");

    const slackConfiguration = new SlackChannelConfiguration(this, "chatbotToFatal", {
      slackChannelConfigurationName: "alert_fatal_configuration",
      slackChannelId: getSlackChannelID(),
      slackWorkspaceId: slack.workspaceId,
      notificationTopics: props.topics,
      role: role,
    });
    // æ˜ç¤ºçš„ã«ä¾å­˜é–¢ä¿‚ã‚’ã—ã¦ã„ãªã„å ´åˆã€SlackConfigurationãŒå…ˆã«ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚ŒTopicã®SubscribeãŒå¤±æ•—ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã€‚
    props.topics.map((topics) => slackConfiguration.node.addDependency(topics));
  }
}
```

## åŸå› ã®æ¨æ¸¬

https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-chatbot-slackchannelconfiguration.html

`[AWS::Chatbot::SlackChannelConfiguration](https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-chatbot-slackchannelconfiguration.html#cfn-chatbot-slackchannelconfiguration-snstopicarns)` ã® `[SnsTopicArns](https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-chatbot-slackchannelconfiguration.html#cfn-chatbot-slackchannelconfiguration-snstopicarns)`ãŒCloudFormationã®ä¾å­˜æ€§ã®è¨ˆç®—ã«åˆ©ç”¨ã•ã‚Œãªã„ãŸã‚ã¨æ€ã‚ã‚Œã‚‹ã€‚

ä¾å­˜æ€§ã‚’è€ƒæ…®ã—ã¦ãã‚Œã‚‹ã‚ˆã†ã€ã‚µãƒãƒ¼ãƒˆã«èµ·ç¥¨ã—ã¾ã—ãŸã€‚
