---
title: "CloudFormationã§Stackã®StatusãŒRollbackä¸­ã®å ´åˆã€OutputsãŒå­˜åœ¨ã—ãªã„"
emoji: "ğŸ”–"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["aws", "cloudformation"]
published: true
---

## TL;DR

![](https://storage.googleapis.com/zenn-user-upload/fbtzl5z9053tfcki0gzex0wufdj5)

CloudFormation ã® Stack ã® State ãŒ `UPDATE_ROLLBACK_IN_PROGRESS` ã®å ´åˆã€ `describe-stacks` ã®è¿”ã‚Šå€¤ã« Outputs ãŒå­˜åœ¨ã—ã¾ã›ã‚“ã€‚

## è©³ç´°

State ãŒ `UPDATE_ROLLBACK_IN_PROGRESS` ã®çŠ¶æ…‹ã§ `describe-stacks` ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ãªè¿”ã‚Šå€¤ã«ãªã‚Šã¾ã™ã€‚

```json
[
    {
        "StackId": "arn:aws:cloudformation:ap-northeast-1:******:stack/STACK_NAME/******",
        "StackName": "STACK_NAME",
        "Description": "some description",
        "Parameters": [],
        "CreationTime": "2019-03- 31T06:38:34.000000+00:00",
        "LastUpdatedTime": "2021-02-12T04:01:50.000000+00:00",
        "RollbackConfiguration": {
            "RollbackTriggers": []
        },
        "StackStatus": "UPDATE_ROLLBACK_IN_PROGRESS",
        "StackStatusReason": "some reason"
        "DisableRollback": false,
        "NotificationARNs": [],
        "Capabilities": [
            "CAPABILITY_IAM",
            "CAPABILITY_NAMED_IAM",
            "CAPABILITY_AUTO_EXPAND"
        ],
	// æœ¬æ¥ã“ã“ã« Outputs ãŒã‚ã‚‹ã€‚
        "Tags": [],
        "EnableTerminationProtection": false,
        "DriftInformation": {
            "StackDriftStatus": "NOT_CHECKED"
        }
    }
]
```

ã¾ãŸã€ `--query` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ Outputs ã®å€¤ã‚’å–å¾—ã—ã‚ˆã†ã¨ã—ãŸå ´åˆã€None ãŒè¿”ã‚Šã¾ã™ã€‚

```terminal
$ aws cloudformation describe-stacks --stack-name some-stack --query 'Stacks[0].Outputs[?OutputKey==`SomeKey`]' --output text
None
```

## ã©ã†ã‚„ã£ã¦å­˜åœ¨ã™ã‚‹ã“ã¨ã‚’ç¢ºã‹ã‚ã‚‹ï¼Ÿ

Status ãŒ `*_COMPLETE` ï¼ˆ `UPDATE_COMPLETE`, `UPDATE_ROLLBACK_COMPLETE` ï¼‰ã®å ´åˆã«ã®ã¿å‚ç…§ã™ã‚Œã°ã€None ãŒè¿”ã‚‹ã“ã¨ã¯é¿ã‘ã‚‰ã‚Œã¾ã™ã€‚

```
STATUS="$(aws cloudformation describe-stacks --stack-name some-stack --query 'Stacks[0].StackStatus' --output text)"
if [[ $APRICOT_INFRASTRUCTURE_STATUS != *_COMPLETE ]];
then
    echo "CloudFormation Stack was not COMPLETE."
    exit 1
fi
```
